<?php
function normalize($text) {
	$filters = [
		/* [،؛].. -> [،؛] */
		["/([،؛])+/u", "$1"],
		
		/* [،؛.!؟:] -> [،؛.!؟:]\s */
		["/ *([،؛\.!؟:]) */u", "$1 "],

		/* !\s! -> !! */
		["/(! +){2}/u", "!!"],

		/* ?\s? -> ?? */
		["/(؟ +){2}/u", "؟؟"],

		/* :\s: -> :: */
		["/(: +){2}/u", "::"],
		
		/* .\s. -> .. */
		["/(\. +){2}/u", ".."],

		/* .\w -> . \w */
		["/\.(\w)/u", ". $1"],

		/* .... -> ... . */
		["/(\.{2,})\./u", "$1 ."],

		/* [،؛.!؟:]\w -> [،؛.!؟:]\s\w */
		["/ *([،؛\.!؟:])(\w)/u", "$1 $2"],
		
		/* (( -> « */
		["/\(( *\()+ */u", "«"],

		/* )) -> » */
		["/ *\)( *\))+/u", "»"],

		/* << -> « */
		["/<( *<)+ */u", "«"],

		/* >> -> » */
		["/ *>( *>)+/u", "»"],

		/* :« -> : « */
		["/: *«/u", ": «"],

		/* «\s -> « */
		["/« +/u", "«"],

		/* \s» -> » */
		["/ +»/u", "»"],

		/* \s.. -> \s */
		["/ {2,}/u", " "],
	];
	
	/* Apply Filters */
	foreach($filters as $filter)
		$text = preg_replace($filter[0], $filter[1], $text);
	
	/* Trim Text */
	$text = trim($text);

	return $text;
}
?>
